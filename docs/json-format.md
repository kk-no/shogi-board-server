# JSONでUSIプロトコルを表現するための定義

[USIプロトコルとは？ - 将棋所](http://www.geocities.jp/shogidokoro/usi.html)

## 基本フォーマット

```json
{
  "version": number,
  "command": string,
  "data": {}
}
```

|key|value|description|
|--|--|--|
|version|uint|current: 1|
|command|string|position... |
|data|object|コマンド実行に必要なデータ|

## data

### turn

- `0 || 1`
	- 先手番: 0
	- 後手番: 1

### pieceId

- 駒はnumberで表す
- 後手の駒はマイナス

|種類|先手|後手|先手USI|後手USI|
|:--:|--:|--:|--:|--:|
|空白マス|0|0||
|歩|1|-1|P|p|
|香|2|-2|L|l|
|桂|3|-3|N|n|
|銀|4|-4|S|s|
|金|5|-5|G|g|
|角|6|-6|B|b|
|飛|7|-7|R|r|
|玉|8|-8|K|k|
|と|11|-11|+P|+p|
|成香|12|-12|+L|+l|
|成桂|13|-13|+N|+n|
|成銀|14|-14|+S|+s|
|馬|16|-16|+B|+b|
|龍|17|-17|+R|+r|

### position

```json
{
  "position": [9][9]pieceId,
  "cap_0": []pieceId,
  "cap_1": []pieceId,
  "turn": turn
}
```

|key|value|description|
|--|--|--|
|`position`|`[][]pieceId`|盤上の配置を9×9の配列で表現する|
|`cap_0`|`[]pieceId`|先手の持ち駒を配列で表現する<br>`[歩, 香, 桂, 銀, 金, 角, 飛]`それぞれの枚数を記述する。<br>歩を2枚持っているなら<br>`[2, 0, 0, 0, 0, 0, 0]`<br>飛車と銀を1枚ずつ持っているなら<br>`[0, 0, 0, 1, 0, 0, 1]`|
|`cap_0`|`[]pieceId`|後手の持ち駒を配列で表現する|
|`turn`|`0 \|\| 1`|手番(0: 先手, 1: 後手)|

- 例  

```json
{
  "version": 1,
  "command": "position",
  "data": {
    "position": [
      [-2, -3, -4, -5, -8, 0, -4, -3, -2],
      [0, 0, 0, 0, 0, 0, -5, -6, 0],
      [-1, 0, -1, -1, -1, -1, 0, 0, -1],
      [0, 0, 0, 0, 0, 0, 7, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0],
      [0, -7, 1, 0, 0, 0, 0, 0, 0],
      [1, 0, 0, 1, 1, 1, 1, 0, 1],
      [0, 6, 5, 0, 0, 0, 0, 0, 0],
      [2, 3, 4, 0, 8, 5, 4, 3, 2]
    ],
    "cap_0": [3, 0, 0, 0, 0, 0, 0],
    "cap_1": [2, 0, 0, 0, 0, 0, 0],
    "turn": 1
  }
}
```

```
# 上記局面の棋譜
1 ７六歩(77)  
2 ３四歩(33)  
3 ２六歩(27)  
4 ８四歩(83)  
5 ２五歩(26)  
6 ８五歩(84)  
7 ７八金(69)  
8 ３二金(41)  
9 ２四歩(25)  
10 ２四歩(23)  
11 ２四飛(28)  
12 ８六歩(85)  
13 ８六歩(87)  
14 ８六飛(82)  
15 ３四飛(24)
``` 
  