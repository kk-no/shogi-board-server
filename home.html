<!DOCTYPE html>
<html lang="en">
<head>
	<title>Command Example</title>
	<script type="text/javascript">
		window.onload = function () {
			var conn;
			var msg = document.getElementById("msg");
			var log = document.getElementById("log");

			function appendLog(item) {
				var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;
				log.appendChild(item);
				if (doScroll) {
					log.scrollTop = log.scrollHeight - log.clientHeight;
				}
			}

			document.getElementById("start").onclick = () => {
				const m = {
					version: 1,
					command: "start"
				};
				conn.send(JSON.stringify(m));
			};
			document.getElementById("position").onclick = () => {
				const m = {
					version: 1,
					command: "position",
					data: {
						position: [
							[-2, -3, -4, -5, -8, 0, -4, -3, -2],
							[0, 0, 0, 0, 0, 0, -5, -6, 0],
							[-1, 0, -1, -1, -1, -1, 0, 0, -1],
							[0, 0, 0, 0, 0, 0, 7, 0, 0],
							[0, 0, 0, 0, 0, 0, 0, 0, 0],
							[0, -7, 1, 0, 0, 0, 0, 0, 0],
							[1, 0, 0, 1, 1, 1, 1, 0, 1],
							[0, 6, 5, 0, 0, 0, 0, 0, 0],
							[2, 3, 4, 0, 8, 5, 4, 3, 2],
						],
						cap_0: [3, 0, 0, 0, 0, 0, 0],
						cap_1: [2, 0, 0, 0, 0, 0, 0],
						turn: 1,
					},
				};
				conn.send(JSON.stringify(m));
			};
			document.getElementById("quit").onclick = () => {
				const m = {
					version: 1,
					command: "quit"
				};
				conn.send(JSON.stringify(m));
			};

			if (window["WebSocket"]) {
				conn = new WebSocket("ws://" + document.location.host + "/ws");
				conn.onclose = function (evt) {
					var item = document.createElement("div");
					item.innerHTML = "<b>Connection closed.</b>";
					appendLog(item);
				};
				conn.onmessage = function (evt) {
					var messages = evt.data.split('\n');
					for (var i = 0; i < messages.length; i++) {
						var item = document.createElement("div");
						item.innerText = messages[i];
						appendLog(item);
					}
				};
			} else {
				var item = document.createElement("div");
				item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
				appendLog(item);
			}
		};
	</script>
	<style type="text/css">
		html {
			overflow: hidden;
		}

		body {
			overflow: hidden;
			padding: 0;
			margin: 0;
			width: 100%;
			height: 100%;
			background: gray;
		}

		#log {
			background: white;
			margin: 0;
			padding: 0.5em 0.5em 0.5em 0.5em;
			position: absolute;
			top: 0.5em;
			left: 0.5em;
			right: 0.5em;
			bottom: 3em;
			overflow: auto;
		}

		#log pre {
			margin: 0;
		}

		#form {
			padding: 0 0.5em 0 0.5em;
			margin: 0;
			position: absolute;
			bottom: 1em;
			left: 0px;
			width: 100%;
			overflow: hidden;
		}

		button {
			width: 100px;
			height: 50px;
		}

		.sendMsg {
			color: #2bc425;
		}
	</style>
</head>
<body>
<div id="log"></div>
<form id="form">
	<button id="start">Start</button>
	<button id="position">Position</button>
	<button id="quit">Quit</button>
</form>
</body>
</html>